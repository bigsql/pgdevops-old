<section class="content-header">
    <h1 class="components-update-title-wrapper">
        HOST MANAGER
    </h1>
    <div class="btn-group pull-right " uib-dropdown >
        <button type="button" class="btn btn-default" uib-dropdown-toggle>
            <i class="fa fa-plus" aria-hidden="true"></i>
        </button>
        <ul uib-dropdown-menu role="menu " aria-labelledby="split-button ">
            <li><a href="" ng-click="openGroupsModal()">Add Group</a></li>
            <li><a href="" ng-click="open()">Add Host</a></li>
        </ul>
    </div>
</section>

<span id="components"></span>
<section class="content">
    <div ng-if="nothingInstalled" class="jumbotron"
         style="background-color: #fff; margin-top: 15px; text-align: center;"><h3> You haven't registered any
        hosts.</h3></div>

    <div class="hostmanager-accordian-wrapper" ng-if="!loading">
        <div class="box">
            <uib-accordion close-others="true">
                <uib-accordion-group ng-repeat="group in groupsList" is-open="group.state"  ng-init="parentIndex = $index" >
                    <uib-accordion-heading>
                        <span ng-click="loadGroup($index)" ng-if="group.group == 'default'">
                            <i class="pull-left glyphicon" ng-class="{'fa fa-plus': !group.state, 'fa fa-minus': group.state}"></i> &nbsp;All Hosts
                        </span>
                        <span ng-click="loadGroup($index)" ng-if="group.group != 'default'">
                            <i class="pull-left glyphicon" ng-class="{'fa fa-plus': !group.state, 'fa fa-minus': group.state}"></i>&nbsp; {{group.group}}
                        </span>
                            <div class="pull-right" style="margin-top: -10px">
                                &nbsp;
                                <div class="btn-group" uib-dropdown >
                                    <button id="split-button " type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); openGroupsModal($index)" class="btn btn-default " ng-if="group.group!='default'" >Edit Group</button>
                                    <button type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation()" class="btn btn-default " ng-if="group.group!='default'"  uib-dropdown-toggle>
                                        <span class="caret "></span>
                                        <span class="sr-only ">Split button!</span>
                                    </button>
                                    <ul uib-dropdown-menu role="menu " aria-labelledby="split-button ">
                                        <li><a  ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); deleteGroup($index)" href="">Delete</a></li>
                                    </ul>
                                </div>
                            </div>
                    </uib-accordion-heading>
                    <div class="col-md-12">
                        <div ng-if="group.hosts.length == 0">There are no servers added in this group.</div>
                        <uib-accordion close-others="true" >
                            <uib-accordion-group ng-repeat="host in group.hosts" is-open="host.state" ng-init="hostIndex = $index">
                                <uib-accordion-heading>
                                        <span ng-click="loadHost(parentIndex, $index, false); stopCalls()" ng-if="host.host != 'localhost' && host.name != host.host"> &nbsp; {{host.name}} &nbsp; ({{ host.host }})
                                            &nbsp; &nbsp; &nbsp;
                                            {{host.hostInfo.os}} {{ host.hostInfo.mem }} GB, {{ host.hostInfo.cores }} x {{host.hostInfo.cpu}}
                                            <i class="pull-left glyphicon" ng-class="{'fa fa-plus': !host.state, 'fa fa-minus': host.state}"></i>
                                        </span>
                                        <span ng-click="loadHost(parentIndex, $index, false); stopCalls()" ng-if="host.host == 'localhost' || host.name == host.host"> &nbsp; {{host.host}}  
                                            &nbsp; &nbsp; &nbsp;
                                            {{host.hostInfo.os}} {{ host.hostInfo.mem }} GB, {{ host.hostInfo.cores }} x {{host.hostInfo.cpu}}
                                            <i class="pull-left glyphicon" ng-class="{'fa fa-plus': !host.state, 'fa fa-minus': host.state}"></i>
                                        </span>
                                        <div class="pull-right" style="margin-top: -10px">
                                            &nbsp;
                                            <button type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); loadHost(parentIndex,$index,true)" class="btn btn-default" ng-if="host.state">Refresh</button>&nbsp;
                                            <button type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); UpdateManager($index)" class="btn btn-default" ng-if="host.state" class="ng-binding" href="" >Package Manager</button>&nbsp;
                                            <button type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); showTop($index)" class="btn btn-default" ng-if="host.state" class="ng-binding" href="">Top</button>&nbsp;
                                            <div class="btn-group" uib-dropdown >
                                                <button id="split-button " type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); open(parentIndex, $index)" class="btn btn-default " ng-if="host.host!='localhost'" >Edit Host</button>
                                                <button type="button" ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation()" class="btn btn-default " ng-if="host.host!='localhost'"  uib-dropdown-toggle>
                                                    <span class="caret "></span>
                                                    <span class="sr-only ">Split button!</span>
                                                </button>
                                                <ul uib-dropdown-menu role="menu " aria-labelledby="split-button ">
                                                    <li><a  ng-click="$event.stopPropagation();$event.preventDefault();openNewLocation(); deleteHost($index)" href="">Delete</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                </uib-accordion-heading>

                                <div class="col-md-7 col-sm-12 col-xs-12" ng-if="host.hostInfo.home">

                                    <!-- <span style="float: right;" ng-click="loadHost(parentIndex, $index,true)">


                                    </span> -->

                                    <p><strong>PGC : </strong>{{ host.hostInfo.version }} {{ host.hostInfo.home }}</p>

                                    <p>
                                    <div style="padding:0;" class="col-md-4 col-sm-6 col-xs-12" ng-click="openGraphModal('CPU Load')">
                                        <div class="host-perf-viz">
                                                <h5>CPU Load</h5>
                                            <nvd3 options="cpuChart" data="cpuData" showLegend="false"></nvd3>
                                        </div>
                                    </div>
                                    <div style="padding:0;" class="col-md-4 col-sm-6 col-xs-12" ng-click="openGraphModal('Disk IO')">
                                        <div class="host-perf-viz">
                                                <h5>Disk IO</h5>
                                            <nvd3 options="ioChart" data="diskIO" showLegend="false"></nvd3>
                                        </div>
                                    </div>
                                    <div style="padding:0;" class="col-md-4 col-sm-6 col-xs-12" ng-click="openGraphModal('Network IO')">
                                        <div class="host-perf-viz">
                                                <h5>Network IO</h5>
                                            <nvd3 options="networkChart" data="NetworkIO" showLegend="false"></nvd3>
                                        </div>
                                    </div>
                                    </p>
                                </div>

                                <div ng-if="hostStatus">
                                    <i class="fa fa-cog fa-spin fa-5x fa-fw margin-bottom"></i>
                                    <span><h3>Loading...</h3></span>
                                </div> 
                                <span ng-if="retry" style="text-align: center;"> <h4>Cannot connect to PGC. Retrying connection ... </h4> </span>

                                <div class="col-md-5 col-sm-12 col-xs-12" ng-if="host.comps">
                                    <div ng-if="host.showMsg" class="jumbotron"
                                         style="background-color: #fff; margin-top: 15px; text-align: center;">
                                        <h4> No PostgreSQL or server components installed.<br \> Visit the <a ng-click="UpdateManager($index)" href="">Update
                                            Manager</a> to install components.</h4>
                                    </div>
                                    <div class="box" ng-if='host.showMsg == false'>
                                        <div class="box-header with-border">
                                            <h3 class="box-title">Services</h3>
                                        </div>
                                        <div class="box-body">
                                            <table class="table" id="serversTable">
                                                <thead>
                                                <tr>
                                                    <th class="col-md-2 col-xs-2">Component</th>
                                                    <th class="col-md-6 col-xs-6">Status</th>
                                                    <!-- <th class="col-md-1 col-xs-1"></th> -->
                                                    <th class="col-md-3 col-xs-3">Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody id="serversTableBody">
                                                <tr ng-repeat="comp in host.comps" ng-if="comp.component != 'pgdevops'">
                                                    <td class="col-md-1 col-xs-2">
                                                        <div ng-if="comp.category != 1">
                                                            <a ng-click="changeHost(host.host); openDetailsModal(comp.component)">
                                                                {{ comp.component }}
                                                            </a>
                                                        </div>
                                                        <div ng-if="comp.category == 1">
                                                            <a ui-sref="components.detailspg95({component:comp.component}) " ng-click="changeHost(host.host)">
                                                                {{ comp.component }}
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="col-md-6 col-xs-6" style="white-space: nowrap;">
                                                        <i ng-class="statusColors[comp.state]" style="margin-top:2px;margin-right:10px" class="fa fa-stop fa-2x pull-left" ng-hide="comp.showingSpinner"></i>
                                                        <div style="margin-top: 5px" ng-show="comp.port && !comp.showingSpinner">{{ comp.state }} on port {{ comp.port }}</div>
                                                        <div style="margin-top: 5px" ng-show="!comp.port">{{ comp.state }}</div>
                                                        <span ng-show="comp.showingSpinner">
                                                            <i class='fa fa-spinner fa-2x  fa-pulse'></i>
                                                        </span>
                                                    </td>
                                                    <!-- <td class="col-md-1 col-xs-1">
                                                        <span ng-show="comp.showingSpinner"><i
                                                                class='fa fa-spinner fa-2x  fa-pulse'></i></span>
                                                    </td> -->
                                                    <td class="col-md-5 col-xs-3" value="{{ comp.component }}" ng-click="action( $event, host.host)">
                                                        <a class="btn btn-default" ng-show="comp.state =='Not Initialized' " ng-click="openInitPopup(comp.component)"
                                                           ng-disabled=" comp.showingSpinner != undefined">Initialize</a>
                                                        <a class="btn btn-default" id="install" ng-show="comp.state =='Stopped'"
                                                           ng-disabled=" comp.showingSpinner != undefined">Start</a>

                                                        <div class="btn-group" uib-dropdown ng-show="comp.state =='Running'">
                                                            <button id="split-button" type="button" class="btn btn-default"
                                                                    ng-disabled="{{ comp.component=='devops' }}">Action
                                                            </button>
                                                            <button type="button" class="btn btn-default" uib-dropdown-toggle
                                                                    ng-disabled="{{ comp.component=='devops' }}" ng-click="stopServerCall()">
                                                                <span class="caret"></span>
                                                                <span class="sr-only">Split button!</span>
                                                            </button>
                                                            <ul uib-dropdown-menu role="menu" aria-labelledby="split-button">
                                                                <li role="menuitem" ng-click="startServerCall(parentIndex, hostIndex )"><a>Stop</a></li>
                                                                <li role="menuitem" ng-click="startServerCall(parentIndex, hostIndex )"><a>Restart</a></li>
                                                            </ul>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </uib-accordion-group>
                        </uib-accordion>
                    </div>
                </uib-accordion-group>
            </uib-accordion>
        </div>
    </div>

</section>