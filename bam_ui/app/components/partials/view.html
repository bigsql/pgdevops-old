<section class="content-header">
    <server-info-details title="Package Manager"></server-info-details>
    <div class="components-update-button-wrapper">
        <label>
            <input type="checkbox" ng-model="isList" ng-click="setTest()">&nbsp; Show test components</input>
        </label>
        &nbsp;
        &nbsp;
        <label>
            <input type="checkbox" ng-model="showInstalled" ng-disabled="disableShowInstalled" ng-click="installedComps()"></input> Show installed only
        </label>
        &nbsp;
        &nbsp;
        <button ng-click="open('manual')" class="btn btn-default" type="button" ng-if="updateSettings == 'manual'"> Check for updates now</button>         
    </div>
    <uib-alert ng-repeat="alert in alerts" type="{{alert.type}}" dismiss-on-timeout="8000" close="closeAlert()" class="uib-text">{{alert.msg}}</uib-alert>
</section>

<span id="components"></span>
<section class="content">
    <uib-tabset>
        <uib-tab class="col-md-6" heading="PostgreSQL">
            <uib-tab-heading>
              <div style="text-align: center;">PostgreSQL</div>
            </uib-tab-heading>
            <div ng-if="loading" style="position: absolute;width: 100px; height: 50px; top: 50%;left: 50%; margin-left: -50px; margin-top: -25px;">
                <i class="fa fa-cog fa-spin fa-5x fa-fw margin-bottom"></i>
                <span><h3>Loading...</h3></span>
            </div>
            <span ng-if="retry" style="text-align: center;"> <h4>Cannot connect to PGC. Retrying connection ... </h4> </span>
            <div ng-if="nothingInstalled" class="jumbotron" style="background-color: #fff; margin-top: 15px; text-align: center;"> <h3> You haven't installed anything yet</h3>
            </div>
            <div ng-if="!loading && !retry">
                <div ng-repeat="(key, value) in components | groupBy: 'category_desc'">
                    <div class="box-header" ng-if="key != 'Extensions'">
                        <h3 class="box-title" ng-bind="key" ng-if="value.length"></h3>
                    </div>
                    <div class="row">
                        <div class="col-md-2 col-sm-3 col-xs-6" ng-repeat="c in value" ng-if="c.category_desc == 'PostgreSQL'">
                            <i class="fa fa-check-circle-o fa-2x pull-right installedSymbol" ng-if="c.status == 'Installed'|| c.status == 'NotInitialized'"></i>
                            <span class="update-component-arrow-wrapper" tooltip-append-to-body="true" uib-tooltip="New version available: {{c.current_version}}" ng-if="c.updates>0">
                                <i class="fa fa-arrow-circle-down fa-2x" id="updateIcon" style="color: #FF8A21"></i>
                            </span>
                            <span class="test-comp-icon" ng-if="c.stage != 'prod'" tooltip-append-to-body="true" uib-tooltip="Test Component"></span>
                            <div ng-class="c.extensionOpened && extensionsList.length ? 'select-comp-area' : 'comp-area'" ng-click="getExtensions(c.component, $index)">
                                <img class="comp-img img-responsive" ng-src="assets/img/component-logos/{{ c.component }}.png"  err-src="assets/img/component-logos/no_img.png" alt="">
                                <div class="caption">
                                    <div style="white-space: nowrap; text-align: center;">
                                        <h5>
                                            <a href="#/details-pg/{{c.component}}">{{c.disp_name}}</a>
                                        </h5>
                                    </div>
                                    <div ng-class="c.extensionOpened ? 'expandExt' : ''" ng-if="extensionsList.length">
                                        <h5 ng-if="c.extensionOpened">
                                            <strong>Extensions</strong>
                                        </h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row extensions-row" ng-if="$index == 0 && extensionsList.length">
                        <div class="col-md-2 col-sm-3 col-xs-6 extensions-area" ng-click="openDetailsModal(ext.component)" style="width: 11.499999995% ; padding: 13px;" ng-repeat="ext in extensionsList">
                            <span class="badge new-comp-wrapper" ng-if="ext.is_new == 1 && ext.status == 'NotInstalled'" style="position: absolute;" tooltip-append-to-body="true" uib-tooltip="Release date: {{ ext.release_date }}">New</span>
                            <i class="fa fa-check-circle-o pull-right installedSymbol" ng-if="ext.status == 'Installed'|| ext.status == 'NotInitialized'" style="position: absolute; margin-left: 95px"></i>
                            <span class="update-component-arrow-wrapper" style="position: absolute;" tooltip-append-to-body="true" uib-tooltip="New version available: {{ext.current_version}}" ng-if="ext.updates>0">
                                <i class="fa fa-arrow-circle-down" id="updateIcon" style="color: #FF8A21"></i>
                            </span>
                            <span class="test-comp-icon" ng-if="ext.stage != 'prod'" tooltip-append-to-body="true" uib-tooltip="Test Component"></span>
                            <div class="extension-area-comp">
                                <img class="comp-img img-responsive ext-img" ng-src="assets/img/component-logos/{{ ext.modifiedName }}.png"  err-src="assets/img/component-logos/no_img.png" alt="">
                                <div class="description-style">
                                    <h5 style="margin-bottom: 4px;">
                                        <a>{{ext.disp_name}}</a>
                                    </h5>
                                    <i>{{ext.short_desc}}</i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row non-pg-comp-row">
                        <div class="col-md-2 col-sm-3 col-xs-6" ng-click="openDetailsModal(c.component)" style="width: 11.499999995% ; padding: 0px 13px 13px 13px;" ng-repeat="c in value" ng-if="c.category_desc != 'PostgreSQL' && c.category_desc != 'Extensions' && c.component != 'devops' && c.component != 'bam2'">
                            <span class="badge new-comp-wrapper" ng-if="c.is_new == 1 && c.status == 'NotInstalled'" tooltip-append-to-body="true" uib-tooltip="Release date: {{ c.release_date }}" style="position: absolute;">New</span>
                            <i class="fa fa-check-circle-o pull-right installedSymbol" ng-if="c.status == 'Installed'|| c.status == 'NotInitialized'" style="position: absolute; margin-left: 95px"></i>
                            <span class="update-component-arrow-wrapper" style="position: absolute;" tooltip-append-to-body="true" uib-tooltip="New version available: {{c.current_version}}" ng-if="c.updates>0">
                                <i class="fa fa-arrow-circle-down" id="updateIcon" style="color: #FF8A21"></i>
                            </span>
                            <span class="test-comp-icon" ng-if="c.stage != 'prod'" tooltip-append-to-body="true" uib-tooltip="Test Component"></span>
                            <div class="extension-area-comp">
                                <img class="comp-img ext-img img-responsive" ng-src="assets/img/component-logos/{{ c.component }}.png"  err-src="assets/img/component-logos/no_img.png" alt="">
                                <div class="description-style">
                                    <h5 style="margin-bottom: 4px;">
                                        <a>{{c.disp_name}}</a>
                                    </h5>
                                    <i>{{c.short_desc}}</i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </uib-tab>
    <uib-tab class="col-md-6" ng-if="showPgDgTab" select="selectPgDg($event)">
        <uib-tab-heading>
          <div style="text-align: center;">PGDG</div>
        </uib-tab-heading>
        <br>
        <div class="pull-right">
            <select class="form-control" ng-model="selectRepo" ng-change="repoChange(selectRepo)" ng-options="repo.repo as repo.repo for repo in pgdgRepoList">
            </select>
        </div>
        <br>
        <br>
        <div class="box">
            <div class="box-body">
                <div id="serversTable">
                    <div class="row component_head_box">
                        <div class="col-md-3 col-sm-3 col-xs-3"><strong>Component</strong></div>
                        <div class="col-md-3 col-sm-3 col-xs-3"><strong>Installed</strong></div>
                        <div class="col-md-3 col-sm-3 col-xs-3"><strong>Version</strong></div>
                        <div class="col-md-3 col-sm-3 col-xs-3"><strong>Actions</strong></div>
                    </div>
                    <div id="serversTableTbody " ng-repeat="c in repoList ">
                        <div ng-if="c.component != 'bam2'" class= "row component_box">
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                <div class="comp-name">
                                    <a class="serversTableTbody-component--link" tooltip-append-to-body="true" ng-bind = "c.component">
                                    {{c.component}}
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3">
                            <i style="color:green; " class="fa fa-check-circle-o fa-2x " ng-if="c.status == 'Installed' && c.removing == undefined || c.status == 'NotInitialized' && c.removing == undefined && c.init == undefined "></i><i class='fa fa-spinner fa-2x  fa-pulse' ng-if="c.removing || c.init">
                            </i>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3">
                                {{c.version}}
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3" style="padding-left: 10px;">
                                <a class="btn btn-default" ng-click="compAction( 'install', c.component) " id="install" ng-if="c.status == 'NotInstalled' || c.status == ''" ng-disabled=" c.installation != undefined">Install</a>
                                <a class="btn btn-default" ng-click="compAction( 'remove', c.component) " id="install" ng-if="c.status == 'Installed'" ng-disabled=" c.removing != undefined">Remove</a>
                                <div class="btn-group " uib-dropdown id="install" ng-if="c.status == 'NotInitialized'">
                                <button id="split-button " type="button" ng-click="openInitPopup(c.component)" ng-disabled="c.init != undefined || c.removing != undefined" class="btn btn-default ">Initialize</button>
                                    <button type="button " class="btn btn-default " uib-dropdown-toggle ng-disabled="c.init != undefined || c.removing != undefined">
                                        <span class="caret "></span>
                                        <span class="sr-only ">Split button!</span>
                                    </button>
                                    <ul uib-dropdown-menu role="menu " aria-labelledby="split-button ">
                                        <li ng-if="c.updates > 0" role="menuitem "><a  ng-click="compAction( 'update', c.component) " href="" ng-hide="{{c.component=='bam2'}}">Update</a></li>
                                        <li role="menuitem "><a ng-click="compAction( 'remove', c.component) " href="" ng-hide="{{c.component=='bam2'}}">Remove</a></li>
                                    </ul>
                                </div>
                                <div class="btn-group" uib-dropdown ng-if="c.updates > 0 && c.status != 'NotInitialized'">
                                        <button id="split-button " type="button " class="btn btn-default" ng-click="compAction( 'update', c.component) " ng-disabled="c.installation != undefined || c.removing != undefined">Update</button>
                                        <button type="button " class="btn btn-default" uib-dropdown-toggle ng-disabled="c.installation != undefined || c.removing != undefined">
                                            <span class="caret "></span>
                                            <span class="sr-only ">Split button!</span>
                                        </button>
                                        <ul uib-dropdown-menu role="menu " aria-labelledby="split-button ">
                                            <li role="menuitem "><a ng-click="compAction( 'remove', c.component) " href="">Remove</a></li>
                                        </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row" ng-if="c.installation != undefined" >
                            <div>

                                <div style="margin-left:10px;margin-top:20px" ng-if="c.installationDependents != undefined"><i class="fa fa-refresh fa-spin" style='margin-right:2px'></i><strong> Installing dependencies...</strong> &nbsp;<button class="btn btn-default btn-xs" ng-click="cancelInstallation('cancelInstall') " >Cancel</button></div>
                                <div style="margin-left:10px;margin-top:20px" ng-if="c.installationStart.status =='start' && c.installationStart.state == 'unpack'"><i class="fa fa-circle-o-notch fa-spin" style='margin-right:2px'></i><strong> Unpacking </strong></div>
                                <div style="margin-left:10px;margin-top:20px" ng-if="c.installationStart.status =='start' && c.installationStart.state == 'download'"><i class="fa fa-circle-o-notch fa-spin" style='margin-right:2px'></i><strong> Downloading </strong></div>

                                <br />
                                <div ng-if="c.installationRunning != undefined && c.installationStart.file" class="col-md-4 col-xs-4">
                                    file:{{c.installationStart.file || c.installationStart.msg}}
                                </div>
                                <div ng-if="c.installationRunning != undefined && c.installationStart.msg && c.installationStart.state=='update'" class="col-md-4 col-xs-4">
                                    {{c.installationStart.msg}}
                                </div>
                                <div class="col-md-4 col-xs-4" ng-if="c.installationRunning != undefined">
                                    <progressbar value="c.progress"></progressbar>
                                    <button class="btn btn-default center-block btn-xs" ng-click="cancelInstallation('cancelInstall') ">Cancel</button>
                                </div>
                                <div class="col-md-1 col-xs-1" ng-if="c.installationRunning != undefined">
                                    {{c.installationRunning.pct}}%
                                </div>
                                <div class="col-md-3 col-xs-3" ng-if="c.installationRunning != undefined">
                                    {{c.installationRunning.mb}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </uib-tab>
    </uib-tabset>
</section>